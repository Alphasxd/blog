---
layout: post
title: ğŸ’»ã€Linuxã€‘Makefile Notes
categories: codetips
---

## å•æ–‡ä»¶Makefile

**test.c**

```c
#include <stdio.h>
int main() {
	printf("hello world\n");
	return 0;
}
```

**ç¼–è¯‘ä¸€ä¸ªCæ–‡ä»¶ï¼Œå¹¶è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶çš„é€šå¸¸åšæ³•ï¼š**

```shell
$ gcc test.c -o test
$ ls
test.c test
$ ./test
hello world
```
> éšç€é¡¹ç›®æ–‡ä»¶æ•°é‡çš„å¢åŠ ï¼Œç¼–è¯‘ä¸€ä¸ªä¸ªå•ç‹¬çš„æ–‡ä»¶æ˜¯ä¸ç°å®çš„ï¼Œæ—¢è´¹æ—¶åˆè´¹åŠ›ä¸”å®¹æ˜“å‡ºé”™

**Makefileçš„åŸºæœ¬æ ¼å¼ï¼š**

```Makefile
target: dependencies
	command
```

**ä»¥ç”Ÿæˆtestä¸ºç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶çš„Makefileï¼š**

```Makefile
test: test.c
	gcc test.c -o test
```

**åœ¨shellä¸­æ‰§è¡Œ `make` å³å¯è°ƒç”¨Makefileæ–‡ä»¶ç¼–è¯‘å‡ºå¯æ‰§è¡Œçš„ç›®æ ‡æ–‡ä»¶ï¼š**

```shell
$ make
gcc test.c -o test
$ ./test
hello world
```
---

## å¤šæ–‡ä»¶Makefileç¼–å†™

**å¤šä¸ªæºæ–‡ä»¶ç›´æ¥ç¼–è¯‘ï¼š**

```shell
$ gcc foo.c bar.c tool.c -o main
```
> å¦‚æœæºæ–‡ä»¶è¿‡å¤šï¼Œå‘½ä»¤ä¼šéå¸¸çš„é•¿ï¼Œè€Œä¸”æœ€å…³é”®çš„é—®é¢˜æ˜¯å¦‚æœå…¶ä¸­ä»»æ„ä¸€ä¸ªå•æ–‡ä»¶æœ‰æ‰€æ”¹åŠ¨ï¼Œåˆ™éœ€è¦é‡æ–°è¾“å…¥å†—é•¿çš„ç¼–è¯‘å‘½ä»¤å®Œæˆç¼–è¯‘

**å…ˆå°†å„ä¸ªå•ç‹¬çš„æ–‡ä»¶ç¼–è¯‘ä¸º.oçš„objæ–‡ä»¶ï¼Œç„¶åå†å°†å¤šä¸ªobjæ–‡ä»¶é“¾æ¥ä¸ºæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶**

![foo](https://imag3s.pages.dev/file/7cf00ef8ed3b58293498c.png)

**ä»¥ç”Ÿæˆmainä¸ºç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶çš„Makefileï¼š**

```Makefile
main: main.c foo.o bar.o tool.o
	gcc main.c foo.o bar.o tool.o -o main 
	
foo.o: foo.c
	gcc -c foo.c
	
bar.o: bar.c
	gcc -c bar.c

tool.o: tool.c
	gcc -c tool.c

clean:
	rm *.o main
```

**åœ¨shellä¸­æ‰§è¡Œ `make` å³å¯è°ƒç”¨Makefileæ–‡ä»¶ç¼–è¯‘å‡ºå¯æ‰§è¡Œçš„ç›®æ ‡æ–‡ä»¶ï¼š**

```shell
$ make
gcc -c tool.c
gcc -c bar.c
gcc -c foo.c
gcc main.c foo.o bar.o tool.o -o main
$ ls
main
$ ./main
```

**åœ¨shellä¸­æ‰§è¡Œ `make clean` å³å¯è°ƒç”¨Makefileæ–‡ä»¶ç¼–è¯‘å‡ºå¯æ‰§è¡Œçš„ç›®æ ‡æ–‡ä»¶ï¼š**

```shell
$ make clean
rm *.o main
```

**è¿›ä¸€æ­¥æ”¹è¿›:**

> åœ¨å¤šæ–‡ä»¶ç¼–è¯‘çš„Makefileç¼–å†™ä¸­ï¼Œæ¯æ¡commandéƒ½ä»¥$gcc$å¼€å¤´ï¼Œè‹¥åç»­éœ€è¦æ›´æ”¹ä¸ºå…¶ä»–å‘½ä»¤åˆ™éœ€è¦ä¸€ä¸ªä¸ªçš„æ›´æ”¹ï¼Œå¤§å¤§å¢åŠ äº†åç»­ç»´æŠ¤çš„éº»çƒ¦ï¼Œå› æ­¤å¼•å…¥å˜é‡è§£å†³æ­¤é—®é¢˜

```makefile
CC = g++
CFLAGS = -lm -Wall -g

main: main.c foo.o bar.o tool.o
	$(CC) $(CFLAGS) main.c foo.o bar.o tool.o -o main 
	
foo.o: foo.c
	$(CC) $(CFLAGS) -c foo.c
	
bar.o: bar.c
	$(CC) $(CFLAGS) -c bar.c

tool.o: tool.c
	$(CC) $(CFLAGS) -c tool.c

clean:
	rm *.o main
```

---

## å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶Makefileç¼–å†™

```makefile
CC = g++
CFLAGS = -lm -Wall -g

all: main_max main_min

main_max: main_max.c foo.o bar.o tool.o
	$(CC) $(CFLAGS) main_max.c foo.o bar.o tool.o -o main_max 
	
main_min: main_min.c foo.o bar.o tool.o
	$(CC) $(CFLAGS) main_min.c foo.o bar.o tool.o -o main_min 
	
foo.o: foo.c
	$(CC) $(CFLAGS) -c foo.c
	
bar.o: bar.c
	$(CC) $(CFLAGS) -c bar.c

tool.o: tool.c
	$(CC) $(CFLAGS) -c tool.c

clean:
	rm *.o main_max main_min
```